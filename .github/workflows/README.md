# GitHub Actions CI

Простой CI workflow для автоматической проверки кода.

## CI Pipeline (`ci.yml`)

**Триггеры:** Push/PR в `main`, `develop`

### Что проверяется:

- **Code Formatting**: Black для форматирования Python кода
- **Linting**: Flake8 для проверки качества кода
- **Tests**: Полный набор тестов (284 теста) с PostgreSQL и Selenium
- **Coverage**: Покрытие кода не менее 80%

### Окружение для тестов:

- **Python 3.11**
- **PostgreSQL 15** (автоматически запускается)
- **Chrome + ChromeDriver** (для Selenium тестов)
- **Все необходимые переменные окружения**

### Что происходит:

#### Тестирование (всегда):
1. Установка зависимостей и Chrome
2. Проверка форматирования с Black
3. Проверка сортировки импортов с isort
4. Линтинг с Flake8
5. Запуск PostgreSQL для тестов
6. Инициализация тестовой БД
7. Запуск всех 284 тестов
8. Проверка покрытия кода (80%+)

#### Деплой (только при push в main):
1. Настройка SSH подключения
2. Подключение к серверу
3. Обновление кода (git pull)
4. Остановка сервисов (docker-compose down)
5. Сборка новых образов (docker-compose build)
6. Запуск сервисов (docker-compose up -d)
7. Очистка старых образов
8. Проверка здоровья сервиса (опционально)

### Настройка деплоя:

Для работы автоматического деплоя добавьте в GitHub Secrets:

```bash
# Обязательные
DEPLOY_HOST=192.168.1.100         # IP адрес вашего сервера
DEPLOY_USER=deploy                # Пользователь для SSH
DEPLOY_SSH_KEY=-----BEGIN...      # Приватный SSH ключ

# Опциональные
HEALTH_CHECK_URL=http://192.168.1.100:8080/health
```

**Требования на сервере:**
- Git репозиторий в `/opt/fiscal-parser`
- Docker и docker-compose установлены
- SSH доступ для пользователя `DEPLOY_USER`
- Файл `docker-compose.yml` в корне проекта

### Результат:

✅ **Зеленый статус** - все проверки прошли + деплой выполнен  
❌ **Красный статус** - есть проблемы с кодом или деплоем

---

*Простой и эффективный CI/CD для поддержания качества кода и автоматического деплоя.*